{{/*
Only create this Secret if there are values to store.
Skip if all secrets use existingSecret references.
*/}}
{{- $hasSecrets := false }}

{{/* Check for provider API keys */}}
{{- if and .Values.gateway.providers.openrouter.enabled .Values.gateway.providers.openrouter.apiKey (not .Values.gateway.providers.openrouter.existingSecret) }}
{{- $hasSecrets = true }}
{{- end }}
{{- if and .Values.gateway.providers.openai.enabled .Values.gateway.providers.openai.apiKey (not .Values.gateway.providers.openai.existingSecret) }}
{{- $hasSecrets = true }}
{{- end }}
{{- if and .Values.gateway.providers.anthropic.enabled .Values.gateway.providers.anthropic.apiKey (not .Values.gateway.providers.anthropic.existingSecret) }}
{{- $hasSecrets = true }}
{{- end }}

{{/* Check for database password */}}
{{- if and (eq .Values.gateway.database.type "postgres") .Values.gateway.database.postgres.password (not .Values.gateway.database.postgres.existingSecret) }}
{{- $hasSecrets = true }}
{{- end }}

{{/* Check for Redis password */}}
{{- if and (eq .Values.gateway.cache.type "redis") .Values.gateway.cache.redis.password (not .Values.gateway.cache.redis.existingSecret) }}
{{- $hasSecrets = true }}
{{- end }}

{{- if $hasSecrets }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hadrian.secretName" . }}
  labels:
    {{- include "hadrian.labels" . | nindent 4 }}
type: Opaque
data:
  {{/* Provider API Keys */}}
  {{- if and .Values.gateway.providers.openrouter.enabled .Values.gateway.providers.openrouter.apiKey (not .Values.gateway.providers.openrouter.existingSecret) }}
  openrouter-api-key: {{ .Values.gateway.providers.openrouter.apiKey | b64enc | quote }}
  {{- end }}
  {{- if and .Values.gateway.providers.openai.enabled .Values.gateway.providers.openai.apiKey (not .Values.gateway.providers.openai.existingSecret) }}
  openai-api-key: {{ .Values.gateway.providers.openai.apiKey | b64enc | quote }}
  {{- end }}
  {{- if and .Values.gateway.providers.anthropic.enabled .Values.gateway.providers.anthropic.apiKey (not .Values.gateway.providers.anthropic.existingSecret) }}
  anthropic-api-key: {{ .Values.gateway.providers.anthropic.apiKey | b64enc | quote }}
  {{- end }}
  {{/* Database Password */}}
  {{- if and (eq .Values.gateway.database.type "postgres") .Values.gateway.database.postgres.password (not .Values.gateway.database.postgres.existingSecret) }}
  database-password: {{ .Values.gateway.database.postgres.password | b64enc | quote }}
  {{- end }}
  {{/* Redis Password */}}
  {{- if and (eq .Values.gateway.cache.type "redis") .Values.gateway.cache.redis.password (not .Values.gateway.cache.redis.existingSecret) }}
  redis-password: {{ .Values.gateway.cache.redis.password | b64enc | quote }}
  {{- end }}
{{- end }}
